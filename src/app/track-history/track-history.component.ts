import { Component } from '@angular/core';
import 'ol/ol.css';
import Map from 'ol/Map';
import View from 'ol/View';
import { Tile as TileLayer, Vector as VectorLayer } from 'ol/layer';
import OSM from 'ol/source/OSM';
import VectorSource from 'ol/source/Vector';
import { LineString, Point } from 'ol/geom';
import Feature from 'ol/Feature';
import { Icon, Stroke, Style } from 'ol/style';
import { fromLonLat } from 'ol/proj';
import { defaults as defaultInteractions } from 'ol/interaction';


@Component({
  selector: 'app-track-history',
  standalone: true,
  imports: [],
  templateUrl: './track-history.component.html',
  styleUrl: './track-history.component.scss'
})
export class TrackHistoryComponent {
  private map!: Map;
  private vectorSource!: VectorSource;
  private trackingLine!: LineString;
  private iconFeature!: Feature<Point>;

  private coordinates: [number, number][] = [[42.67832,17.1612144],[42.67832,17.1612144],[42.6779956,17.1616211],[42.6762356,17.1607722],[42.6751333,17.16073],[42.6749422,17.1611267],[42.6747511,17.1575544],[42.67424,17.1577478],[42.6663644,17.1604689],[42.6653956,17.1609722],[42.6652311,17.1608544],[42.6651511,17.1606256],[42.6643289,17.15465],[42.6639467,17.1541067],[42.6585111,17.1520444],[42.6524711,17.1503089],[42.6451022,17.1490989],[42.6447956,17.1509533],[42.6447467,17.1503067],[42.6446711,17.1490044],[42.6439644,17.1488667],[42.6379511,17.1476178],[42.6310444,17.1451911],[42.6287911,17.14531],[42.6283244,17.1471133],[42.6274489,17.14786],[42.6272667,17.1480256],[42.6273333,17.1478667],[42.6292133,17.1476578],[42.6302711,17.1482044],[42.6358889,17.1481267],[42.6380978,17.1489089],[42.6420267,17.1510367],[42.6504844,17.1520211],[42.6563422,17.1523222],[42.6577733,17.15284],[42.6618667,17.1541156],[42.6639689,17.1540378],[42.6644,17.1538089],[42.6645867,17.1539078],[42.6646444,17.1541289],[42.6655333,17.1602311],[42.6658444,17.1609322],[42.6654711,17.16515],[42.6653289,17.16542],[42.66544,17.1654667],[42.6736578,17.1668033],[42.6737244,17.1666867],[42.6749733,17.1621489],[42.6751511,17.1602378],[42.6751556,17.1603989],[42.6753556,17.1606144],[42.6758533,17.1606689],[42.6782089,17.1611711],[42.6783067,17.1611844],[42.6783067,17.1611844],[42.6784356,17.1614533],[42.6782933,17.1616511],[42.6777822,17.1614033],[42.6776178,17.1611667],[42.6752,17.1607078],[42.6751422,17.1608711],[42.6749733,17.16119],[42.6749956,17.1605944],[42.6749111,17.1575911],[42.6747733,17.15761],[42.6656889,17.1609322],[42.6654667,17.1610144],[42.6652889,17.1609178],[42.6651867,17.1607078],[42.6642756,17.1544822],[42.6640889,17.1544056],[42.6597733,17.1540067],[42.6555778,17.1525056],[42.6482267,17.15189],[42.63932,17.1501733],[42.6355867,17.1482433],[42.6273911,17.1485156],[42.62684,17.1490822],[42.6268356,17.1491489],[42.6262267,17.1493456],[42.62488,17.1492578],[42.6231644,17.1489544],[42.6226044,17.1489844],[42.62176,17.1491544],[42.6216356,17.1491244],[42.6184756,17.1494333],[42.6182978,17.14949],[42.6173067,17.1495833],[42.6172533,17.1497689],[42.6171333,17.15527],[42.6174222,17.1573333],[42.6175778,17.1573867],[42.6226356,17.1580522],[42.62488,17.1582778],[42.6251022,17.1582789],[42.6252311,17.1581244],[42.6256933,17.1538644],[42.6260489,17.1510644],[42.6260533,17.1494311],[42.6227467,17.1489622],[42.6190844,17.1493244],[42.6156889,17.1493567],[42.6133644,17.1490044],[42.6132667,17.1490933],[42.6130444,17.1499333],[42.6124311,17.1539478],[42.6126089,17.1540244],[42.6143067,17.1540433],[42.6168356,17.1541256],[42.6171111,17.14953],[42.6169822,17.1494622],[42.6102267,17.1481378],[42.6091733,17.1477456],[42.6075644,17.1459144],[42.6002222,17.1458456],[42.60252,17.1461867],[42.6101067,17.1462422],[42.6109867,17.1465356],[42.6131556,17.1467056],[42.6137422,17.1463833],[42.6145156,17.14522],[42.6134089,17.1485289],[42.6136089,17.1487711],[42.6163733,17.1494467],[42.61832,17.1494711],[42.6183867,17.1493667],[42.6224,17.1490111],[42.6248933,17.1491889],[42.62632,17.1492711],[42.6265111,17.1491656],[42.6266578,17.1491111],[42.62688,17.1488244],[42.6269333,17.1486967],[42.6270444,17.1487578],[42.62652,17.1492478],[42.6262178,17.1497044],[42.6260756,17.1523167],[42.6255022,17.1566944],[42.6247511,17.1627767],[42.6231467,17.1687856],[42.6225644,17.1722322],[42.6232578,17.1746611],[42.62312,17.1746733],[42.62312,17.1746611],[42.6231556,17.1745056],[42.6227778,17.1732467],[42.62432,17.1641767],[42.6252133,17.15893],[42.6250667,17.1587756],[42.6230711,17.1582889],[42.6229022,17.1581344],[42.6251733,17.1582511],[42.6252844,17.1580067],[42.6258578,17.1533778],[42.6256089,17.1526967],[42.625,17.1524756],[42.6230622,17.1511511],[42.6241556,17.1502911],[42.6245822,17.1491778],[42.62416,17.1486411],[42.6253333,17.1481956],[42.6259867,17.14815],[42.6262844,17.1477433],[42.6256044,17.1458189],[42.6232356,17.1452922],[42.6228844,17.14579],[42.6232756,17.1471444],[42.6236622,17.1475311],[42.6234756,17.1482378],[42.62312,17.1481],[42.6221644,17.1483689],[42.6216444,17.1491222],[42.621,17.1491122],[42.6183778,17.1495156],[42.6187289,17.1493433],[42.6207733,17.1488267],[42.6205022,17.1485078],[42.6204089,17.1484144],[42.6205244,17.1474167],[42.6216311,17.1474589],[42.6229467,17.1477489],[42.6229467,17.1476956],[42.6229911,17.1474189],[42.6231467,17.1465744],[42.6236222,17.1463189],[42.6237378,17.1457267],[42.6249333,17.1455689],[42.6251467,17.1456244],[42.6262533,17.1461122],[42.6256444,17.1471844],[42.6252578,17.1471689],[42.6248978,17.1456867],[42.6237422,17.1455689],[42.6234222,17.1463856],[42.6226978,17.1470144],[42.6220311,17.1487422],[42.6216711,17.1491011],[42.6208178,17.1491033],[42.6191467,17.1493678],[42.6189067,17.1493856],[42.616,17.1494356],[42.6131511,17.1489644],[42.6095689,17.1480356],[42.6079822,17.1476822],[42.6079689,17.1476744],[42.6072444,17.1475011],[42.6069911,17.1474744],[42.6066844,17.1477222],[42.6052089,17.1474667],[42.6049556,17.1474167],[42.6049067,17.1471789],[42.6049289,17.1466622],[42.6048133,17.1461967],[42.6046889,17.1461811],[42.6001067,17.1460022],[42.6000267,17.1459256],[42.5999867,17.1457333],[42.5998267,17.1455633],[42.5987911,17.1451111],[42.5988622,17.1449644],[42.5992089,17.1446744],[42.5995156,17.1446267],[42.6038444,17.1450556],[42.60852,17.1458933],[42.6135333,17.1465856],[42.6139911,17.1460822],[42.61452,17.1452522],[42.6134533,17.1486589],[42.6138533,17.1489089],[42.6179289,17.1494289],[42.6213244,17.1490711],[42.6220444,17.1488367],[42.6228844,17.1478022],[42.6229067,17.1477489],[42.6229289,17.1474567],[42.6242178,17.1478689],[42.6239111,17.1483422],[42.6241689,17.1478978],[42.6241244,17.1487556],[42.6239511,17.1490611],[42.6219022,17.1493889],[42.6218711,17.1498167],[42.6221689,17.1506844],[42.62224,17.1507344],[42.6238578,17.1542744],[42.6221156,17.1542144],[42.6221067,17.1546422],[42.6220533,17.1565133],[42.6189911,17.1566789],[42.6179422,17.1568489],[42.6172311,17.1568056],[42.6171067,17.1565567],[42.6168,17.1544056],[42.6166489,17.1543789],[42.6125333,17.1540789],[42.61256,17.1539511],[42.6128756,17.1539767],[42.6143422,17.1540933],[42.6148089,17.1541133],[42.6162044,17.1542278],[42.61656,17.1544267],[42.6150311,17.1543767],[42.6149733,17.15447],[42.6149733,17.1546267],[42.6150933,17.15481],[42.6150311,17.1547489],[42.6147378,17.1543867],[42.6124089,17.15451],[42.6122044,17.1547833],[42.6101333,17.1603122],[42.6102622,17.1604067],[42.6106089,17.1603189],[42.6137867,17.1583267],[42.6187733,17.15691],[42.6208667,17.15452],[42.6220178,17.1521433],[42.6229422,17.1511178],[42.6243733,17.1521411],[42.6245289,17.1522078],[42.6259733,17.1528278],[42.62564,17.1542911],[42.6241289,17.1542189],[42.6226578,17.1541133],[42.6222889,17.1540811],[42.6221644,17.1554911],[42.6219911,17.15653],[42.6215822,17.1558589],[42.6221289,17.1548633],[42.62212,17.1545867],[42.6221244,17.1544611],[42.6220844,17.1542967],[42.6222711,17.1540544],[42.6227378,17.1541078],[42.6230711,17.1541578],[42.6238933,17.1542411],[42.62404,17.1542133],[42.6250844,17.1540322],[42.6256,17.1544878],[42.6254444,17.1585333],[42.6253467,17.1587922],[42.62512,17.15876],[42.6248133,17.1586322],[42.6201556,17.1578844],[42.6148756,17.1580622],[42.6100622,17.1608222],[42.6099644,17.1607189],[42.6137689,17.1583578],[42.6163733,17.1578011],[42.6176356,17.1583522],[42.6150267,17.1616511],[42.6151378,17.1631644],[42.6149467,17.1647933],[42.6150978,17.1649167],[42.6160844,17.1656022],[42.6158978,17.1651178],[42.6150533,17.1647778],[42.6152222,17.1610989],[42.6180133,17.1575411],[42.6160711,17.1576078],[42.6160844,17.1576156],[42.6161556,17.1575489],[42.6171333,17.1572933],[42.6171467,17.1571122],[42.6170711,17.1566756],[42.6169689,17.1554933],[42.6171022,17.1499578],[42.6172889,17.1494922],[42.6175022,17.1494422],[42.6179556,17.1495367],[42.6178711,17.1500433],[42.6180622,17.1495022],[42.6216133,17.1490878],[42.6240711,17.1489644],[42.6240978,17.1487422],[42.6252578,17.1482622],[42.62564,17.1484056],[42.6259289,17.1483156],[42.6259911,17.1481933],[42.6263867,17.1467456],[42.6258844,17.1458856],[42.6237733,17.1455211],[42.6237333,17.1458133],[42.6236133,17.1463356],[42.6230756,17.1467433],[42.6231111,17.1468833],[42.6239022,17.14786],[42.6242622,17.1478978],[42.6249111,17.1477989],[42.6259378,17.1482467],[42.6263067,17.1478333],[42.6264044,17.1468644],[42.62596,17.1459333],[42.6238178,17.1455044],[42.6237733,17.1457611],[42.6237689,17.1457667],[42.6235956,17.1462378],[42.6225378,17.1477167],[42.62296,17.1476856],[42.62308,17.1473522],[42.6233556,17.1472667],[42.6236933,17.1475867],[42.6238844,17.1478289],[42.6247511,17.1477856],[42.6261733,17.1472],[42.6261422,17.14714],[42.6263333,17.1477011],[42.6262311,17.14801],[42.6256844,17.1483478],[42.6255733,17.1483078],[42.6245022,17.1484356],[42.6233556,17.1491644],[42.6229378,17.1499478],[42.6219289,17.1498656],[42.6218756,17.1498056],[42.6208978,17.1491656],[42.6208756,17.1491567],[42.62048,17.1491167],[42.6177289,17.1494978],[42.6139644,17.1490611],[42.60916,17.1477989],[42.6076044,17.1459811],[42.6013467,17.1462],[42.6001378,17.146],[42.6001733,17.1459122],[42.6003333,17.1459089],[42.6027067,17.1462022],[42.6071378,17.1458167],[42.6088578,17.1459656],[42.6087956,17.1460633],[42.6081689,17.1460989],[42.6081644,17.14628],[42.6091511,17.1475333],[42.6099289,17.1479989],[42.6159689,17.14937],[42.6187556,17.1493211],[42.6219778,17.1492022],[42.6220089,17.1493456],[42.6219822,17.1501356],[42.62224,17.1507433],[42.62292,17.1509989],[42.6235067,17.1506667],[42.6245067,17.14961],[42.6248533,17.1492711],[42.6253511,17.1493722],[42.6264356,17.1486267],[42.6263244,17.1479744],[42.6264489,17.1459633],[42.6275333,17.1465811],[42.6277556,17.14678],[42.6282267,17.1466278],[42.62832,17.1468089],[42.6286978,17.1484122],[42.6288178,17.1484222],[42.6350844,17.1481344],[42.6381067,17.1490844],[42.6439378,17.1513733],[42.6451333,17.1514456],[42.6451422,17.1514667],[42.6462533,17.1516211],[42.6539778,17.1525111],[42.6603467,17.1541467],[42.6639644,17.1541867],[42.6644756,17.1539378],[42.6646444,17.1541],[42.66588,17.1617889],[42.6654489,17.1655711],[42.6734489,17.1669311],[42.6736622,17.1668889],[42.6737556,17.1667133],[42.6751911,17.16029],[42.6753422,17.16069],[42.6772711,17.1609644],[42.6774489,17.1611444],[42.6782978,17.1612622],[42.6783378,17.1612678],[42.6783378,17.1612678],[42.6440222,17.1420589],[42.6783378,17.1612489],[42.6783378,17.1612489],[42.6783733,17.1613678],[42.6782667,17.1616644],[42.6772978,17.1611367],[42.6767067,17.1609233],[42.67516,17.1608067],[42.6749822,17.1611633],[42.6749022,17.1576044],[42.67476,17.1576067],[42.6668578,17.1603989],[42.6653022,17.1610122],[42.6651956,17.1607911],[42.6642978,17.1545922],[42.6641511,17.1544967],[42.6599022,17.1541533],[42.6551378,17.1525789],[42.64868,17.1520156],[42.6437333,17.1514567],[42.6379467,17.1495589],[42.6345156,17.1484433],[42.6280711,17.1485178],[42.6270667,17.1486878],[42.6263333,17.1493456],[42.6262622,17.1493833],[42.6261733,17.1493989],[42.6230222,17.1490111],[42.6226711,17.1490633],[42.6220089,17.1490956],[42.6226622,17.1490311],[42.6240711,17.1487067],[42.6255644,17.1483744],[42.6259022,17.1483456],[42.6262889,17.1475756],[42.6263333,17.1471822],[42.6260311,17.1459067],[42.6237289,17.1456733],[42.6236,17.1463089],[42.6222667,17.1477244],[42.6221289,17.1484933],[42.6221022,17.1488],[42.6219111,17.1491067],[42.6186978,17.1493911],[42.6173689,17.1495833],[42.6172889,17.1497633],[42.6171467,17.1554544],[42.6174044,17.1573711],[42.6175511,17.1574156],[42.6209956,17.1577778],[42.6210533,17.1577944],[42.6242178,17.1583211],[42.6250622,17.15834],[42.6251911,17.15823],[42.6252844,17.1579378],[42.6258,17.1534933],[42.6260222,17.1523878],[42.62608,17.15041],[42.6261556,17.1493722],[42.6264978,17.1488078],[42.6261867,17.1459578],[42.6238978,17.1454222],[42.6237733,17.14572],[42.62324,17.1465356],[42.6222089,17.1478578],[42.6225867,17.1489789],[42.6235333,17.1489733],[42.6240222,17.1488767],[42.6235022,17.14821],[42.6231244,17.1480444],[42.6223333,17.1476989],[42.6216222,17.1474967],[42.6216978,17.1468544],[42.6231689,17.1471333],[42.6246267,17.1477378],[42.62476,17.1477033],[42.6244444,17.1484244],[42.6243689,17.1490456],[42.6246889,17.1493222],[42.6246,17.1495967],[42.6240844,17.15041],[42.6223867,17.1515156],[42.6222978,17.1515922],[42.6220489,17.1520444],[42.6219333,17.1534256],[42.6217911,17.1534522],[42.6203822,17.15534],[42.6197911,17.1558556],[42.6185511,17.1569744],[42.6185067,17.1569344],[42.6177956,17.1568278],[42.6171689,17.1566833],[42.6169911,17.1553311],[42.6169778,17.1507111],[42.6172444,17.1494789],[42.6173778,17.1494333],[42.6203244,17.1489889],[42.6220444,17.1488478],[42.6220756,17.1484511],[42.6224844,17.1483189],[42.6223111,17.1474433],[42.6229689,17.1467689],[42.62364,17.1473767],[42.6240578,17.1487144],[42.6238089,17.1490722],[42.6219644,17.1488111],[42.6224267,17.1472033],[42.6231822,17.1465678],[42.6236267,17.1458344],[42.6238356,17.14534],[42.6244178,17.1454122],[42.6262444,17.1457978],[42.6265289,17.1451189],[42.6268178,17.1450256],[42.6290178,17.1444222],[42.6303244,17.1434078],[42.6318489,17.14353],[42.6365333,17.1436344],[42.6456044,17.1418189],[42.6468,17.14241],[42.6508667,17.1476],[42.6528222,17.1501178],[42.6589778,17.1521433],[42.6646622,17.15407],[42.66468,17.1542544],[42.6656089,17.1604156],[42.6658311,17.1610322],[42.6654089,17.1655278],[42.6655333,17.1655711],[42.6731956,17.1668811],[42.6736533,17.1668944],[42.6737644,17.1667422],[42.67524,17.16024],[42.6752489,17.1603356],[42.6755244,17.1607111],[42.6760667,17.1607856],[42.6777333,17.16123],[42.6783511,17.1612678],[42.6783511,17.1612678],[42.6783244,17.1612667],[42.6783778,17.1616722],[42.6778889,17.1615967],[42.6778178,17.1614378],[42.6774578,17.16112],[42.6772844,17.1609444],[42.6771378,17.1608911],[42.6751689,17.1607722],[42.6750089,17.1611344],[42.6750133,17.1609589],[42.6748533,17.15762],[42.66616,17.1606278],[42.6654222,17.1609978],[42.6652756,17.1608844],[42.66524,17.1607089],[42.6642978,17.1545622],[42.6641689,17.15447],[42.6594489,17.1538844],[42.6555822,17.1525178],[42.6480089,17.1518989],[42.6449689,17.1516933],[42.6450444,17.1523633],[42.64524,17.15682],[42.6463378,17.1615622],[42.6470222,17.1620344],[42.6541111,17.1631189],[42.6619022,17.1619244],[42.6657467,17.16052],[42.6658844,17.16074],[42.6658622,17.1643578],[42.6654,17.16551],[42.6655778,17.1655422],[42.6737422,17.1668222],[42.6738711,17.16658],[42.6752222,17.16024],[42.6753689,17.1606489],[42.6773556,17.1610144],[42.6775111,17.16112],[42.6783333,17.1612322],[42.6783333,17.1612322],[42.6783333,17.1612322]]
  private currentIndex = 0;

  constructor() { }

  ngOnInit(): void {
    this.initializeMap();

    setInterval(() => {
      if (this.currentIndex < this.coordinates.length) {
        this.updateTrackingLine(this.coordinates[this.currentIndex]);
        // this.updateTrackingIcon(this.coordinates[this.currentIndex])
        this.currentIndex++;
      }
    }, 1000);
  }

  initializeMap(): void {
    this.trackingLine = new LineString([]);

    const lineFeature = new Feature(this.trackingLine);
    const lineStyle = new Style({
      stroke: new Stroke({
        color: 'blue',
        width: 2
      })
    });
    lineFeature.setStyle(lineStyle);

    this.vectorSource = new VectorSource({
      features: [lineFeature]
    });

    const vectorLayer = new VectorLayer({
      source: this.vectorSource
    });

    this.map = new Map({
      target: 'map',
      layers: [
        new TileLayer({
          source: new OSM()
        }),
        vectorLayer
      ],
      view: new View({
        center: fromLonLat([42.67832,17.1612144],),
        zoom: 14
      })
    });




    // Create an icon feature for the first coordinate
    // this.iconFeature = new Feature(new Point(fromLonLat(this.coordinates[0])));
    // const iconStyle = new Style({
    //   image: new Icon({
    //     src: '../assets/car.svg',
    //     scale: 1 // Adjust scale as needed
    //   })
    // });
    // this.iconFeature.setStyle(iconStyle);
    // this.vectorSource.addFeature(this.iconFeature);

    // // Create icon features for each coordinate
    // this.coordinates.forEach(coordinate => {
    //   const iconFeature = new Feature(new Point(fromLonLat(coordinate)));
    //   iconFeature.setStyle(iconStyle);
    //   this.vectorSource.addFeature(iconFeature);
    // });
  }

  updateTrackingLine(coordinate: [number, number]): void {
    const transformedCoordinate = fromLonLat(coordinate); // Convert to map projection
    this.trackingLine.appendCoordinate(transformedCoordinate);
    this.vectorSource.changed(); // Notify the source that it has changed
  }

  updateTrackingIcon(coordinate: [number, number]): void {
    const transformedCoordinate = fromLonLat(coordinate); // Convert to map projection
    const geometry = this.iconFeature.getGeometry() as Point;
    geometry.setCoordinates(transformedCoordinate);
    this.vectorSource.changed(); // Notify the source that it has changed
  }
}